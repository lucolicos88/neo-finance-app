<script>
// Dados globais
let usuariosData = [];

function loadConfiguracoesData() {
  setupConfigTabs();
  loadCentrosCusto();
  loadPlanoContas();
  loadCanais();
  loadFiliais();
  loadUsuarios();
}

function setupConfigTabs() {
  const tabs = document.querySelectorAll('[data-tab-group="config"]');
  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      const tabName = this.getAttribute('data-tab');
      ModalManager.closeAll();
      switchTab('config', tabName);
    });
  });
}

// ---------------------------------------------------------------------------
// Centros de Custo
// ---------------------------------------------------------------------------
function loadCentrosCusto() {
  const tbody = document.getElementById('table-centros-custo');
  if (!tbody) return;

  if (!appData.centrosCusto || appData.centrosCusto.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhum centro de custo cadastrado</td></tr>';
    return;
  }

  tbody.innerHTML = appData.centrosCusto.map((cc, index) => `
    <tr>
      <td><strong>${cc.codigo}</strong></td>
      <td>${cc.nome}</td>
      <td>
        <span class="badge badge-${cc.ativo === false ? 'secondary' : 'success'}">
          ${cc.ativo === false ? 'Inativo' : 'Ativo'}
        </span>
      </td>
      <td class="text-right">
        <button class="btn btn-sm btn-secondary" onclick="editarCentroCusto(${index})" title="Editar">âœŽ</button>
        <button class="btn btn-sm ${cc.ativo === false ? 'btn-success' : 'btn-warning'}" onclick="alternarCentroCusto(${index}, ${cc.ativo === false})" title="${cc.ativo === false ? 'Ativar' : 'Inativar'}">
          ${cc.ativo === false ? 'Ativar' : 'Inativar'}
        </button>
        <button class="btn btn-sm btn-danger" onclick="excluirCentroCusto(${index})" title="Excluir">ðŸ—‘</button>
      </td>
    </tr>
  `).join('');
}

function openModalNovoCentroCusto() {
  document.getElementById('titulo-centro-custo').textContent = 'Novo Centro de Custo';
  document.getElementById('cc-edit-index').value = '';
  document.getElementById('form-centro-custo').reset();
  const ativo = document.getElementById('cc-ativo');
  if (ativo) ativo.checked = true;
  ModalManager.open('modal-centro-custo');
}

function editarCentroCusto(index) {
  const cc = appData.centrosCusto[index];
  document.getElementById('titulo-centro-custo').textContent = 'Editar Centro de Custo';
  document.getElementById('cc-edit-index').value = index;
  document.getElementById('cc-codigo').value = cc.codigo;
  document.getElementById('cc-nome').value = cc.nome;
  const ativo = document.getElementById('cc-ativo');
  if (ativo) ativo.checked = cc.ativo !== false;
  ModalManager.open('modal-centro-custo');
}

function salvarCentroCusto() {
  const codigo = document.getElementById('cc-codigo').value.trim().toUpperCase();
  const nome = document.getElementById('cc-nome').value.trim();
  const ativo = document.getElementById('cc-ativo').checked;
  const editIndex = document.getElementById('cc-edit-index').value;

  if (!codigo || !nome) {
    showToast('Preencha todos os campos obrigatÃ³rios', 'warning');
    return;
  }

  showLoading('Salvando centro de custo...');
  const centroCusto = { codigo, nome, ativo };

  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        ModalManager.close('modal-centro-custo');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .salvarCentroCusto(centroCusto, editIndex !== '' ? parseInt(editIndex) : -1);
}

function excluirCentroCusto(index) {
  openConfirmCentroCusto('Tem certeza que deseja excluir este centro de custo?', index);
}

function alternarCentroCusto(index, ativar) {
  showLoading(ativar ? 'Ativando centro de custo...' : 'Inativando centro de custo...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .toggleCentroCusto(index, ativar);
}

// Confirm center cost
let ccIndexParaExcluir = null;
function openConfirmCentroCusto(msg, index) {
  ccIndexParaExcluir = index;
  const msgEl = document.getElementById('confirm-cc-message');
  if (msgEl) msgEl.textContent = msg;
  ModalManager.open('modal-confirm-cc');
}

function confirmExcluirCentroCusto() {
  if (ccIndexParaExcluir === null) return;
  const index = ccIndexParaExcluir;
  ccIndexParaExcluir = null;
  ModalManager.close('modal-confirm-cc');
  showLoading('Excluindo...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .excluirCentroCusto(index);
}

// ---------------------------------------------------------------------------
// Plano de Contas
// ---------------------------------------------------------------------------
function loadPlanoContas() {
  const tbody = document.getElementById('table-plano-contas');
  if (!tbody) return;

  if (!appData.contas || appData.contas.length === 0) {
    tbody.innerHTML = '<tr><td colspan="9" class="text-center text-muted">Nenhuma conta cadastrada</td></tr>';
    return;
  }

  tbody.innerHTML = appData.contas.map((conta, index) => `
    <tr>
      <td><strong>${conta.codigo}</strong></td>
      <td>${conta.nome}</td>
      <td><span class="badge badge-${conta.tipo === 'RECEITA' ? 'success' : (conta.tipo === 'ATIVO' ? 'info' : 'danger')}">${conta.tipo || 'N/A'}</span></td>
      <td>${conta.grupoDRE || '-'}</td>
      <td>${conta.subgrupoDRE || '-'}</td>
      <td>${conta.grupoDFC || '-'}</td>
      <td>${conta.variavelFixa || '-'}</td>
      <td>${conta.cmaCmv || '-'}</td>
      <td class="text-right">
        <button class="btn btn-sm btn-secondary" onclick="editarConta(${index})" title="Editar">âœŽ</button>
        <button class="btn btn-sm btn-danger" onclick="excluirConta(${index})" title="Excluir">ðŸ—‘</button>
      </td>
    </tr>
  `).join('');
}

function openModalNovaConta() {
  document.getElementById('titulo-conta').textContent = 'Nova Conta ContÃ¡bil';
  document.getElementById('conta-edit-index').value = '';
  document.getElementById('form-conta-contabil').reset();
  document.getElementById('conta-grupo-dre').value = '';
  document.getElementById('conta-subgrupo-dre').value = '';
  document.getElementById('conta-grupo-dfc').value = '';
  document.getElementById('conta-variavel-fixa').value = '';
  document.getElementById('conta-cma-cmv').value = '';
  ModalManager.open('modal-conta-contabil');
}

function editarConta(index) {
  const conta = appData.contas[index];
  document.getElementById('titulo-conta').textContent = 'Editar Conta ContÃ¡bil';
  document.getElementById('conta-edit-index').value = index;
  document.getElementById('conta-codigo').value = conta.codigo;
  document.getElementById('conta-nome').value = conta.nome;
  document.getElementById('conta-tipo').value = conta.tipo || '';
  document.getElementById('conta-grupo-dre').value = conta.grupoDRE || '';
  document.getElementById('conta-subgrupo-dre').value = conta.subgrupoDRE || '';
  document.getElementById('conta-grupo-dfc').value = conta.grupoDFC || '';
  document.getElementById('conta-variavel-fixa').value = conta.variavelFixa || '';
  document.getElementById('conta-cma-cmv').value = conta.cmaCmv || '';
  ModalManager.open('modal-conta-contabil');
}

function salvarContaContabil() {
  const codigo = document.getElementById('conta-codigo').value.trim();
  const nome = document.getElementById('conta-nome').value.trim();
  const tipo = document.getElementById('conta-tipo').value;
  const grupoDRE = document.getElementById('conta-grupo-dre').value.trim();
  const subgrupoDRE = document.getElementById('conta-subgrupo-dre').value.trim();
  const grupoDFC = document.getElementById('conta-grupo-dfc').value.trim();
  const variavelFixa = document.getElementById('conta-variavel-fixa').value;
  const cmaCmv = document.getElementById('conta-cma-cmv').value;
  const editIndex = document.getElementById('conta-edit-index').value;

  if (!codigo || !nome || !tipo) {
    showToast('Preencha todos os campos obrigatÃ³rios', 'warning');
    return;
  }

  showLoading('Salvando conta...');

  const conta = { codigo, nome, tipo, grupoDRE, subgrupoDRE, grupoDFC, variavelFixa, cmaCmv };

  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        ModalManager.close('modal-conta-contabil');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .salvarContaContabil(conta, editIndex !== '' ? parseInt(editIndex) : -1);
}

function excluirConta(index) {
  openConfirmConta('Tem certeza que deseja excluir esta conta?', index);
}

let contaIndexParaExcluir = null;
function openConfirmConta(msg, index) {
  contaIndexParaExcluir = index;
  const msgEl = document.getElementById('confirm-conta-message');
  if (msgEl) msgEl.textContent = msg;
  ModalManager.open('modal-confirm-conta');
}

function confirmExcluirConta() {
  if (contaIndexParaExcluir === null) return;
  const index = contaIndexParaExcluir;
  contaIndexParaExcluir = null;
  ModalManager.close('modal-confirm-conta');
  showLoading('Excluindo...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .excluirConta(index);
}

// ---------------------------------------------------------------------------
// Canais
// ---------------------------------------------------------------------------
let canalIndexParaExcluir = null;

function loadCanais() {
  const tbody = document.getElementById('table-canais');
  if (!tbody) return;

  if (!appData.canais || appData.canais.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhum canal cadastrado</td></tr>';
    return;
  }

  tbody.innerHTML = appData.canais.map((canal, index) => `
    <tr>
      <td><strong>${canal.codigo}</strong></td>
      <td>${canal.nome}</td>
      <td>
        <span class="badge badge-${canal.ativo === false ? 'secondary' : 'success'}">
          ${canal.ativo === false ? 'Inativo' : 'Ativo'}
        </span>
      </td>
      <td class="text-right">
        <button class="btn btn-sm btn-secondary" onclick="editarCanal(${index})" title="Editar">âœŽ</button>
        <button class="btn btn-sm ${canal.ativo === false ? 'btn-success' : 'btn-warning'}" onclick="alternarCanal(${index}, ${canal.ativo === false})" title="${canal.ativo === false ? 'Ativar' : 'Inativar'}">
          ${canal.ativo === false ? 'Ativar' : 'Inativar'}
        </button>
        <button class="btn btn-sm btn-danger" onclick="excluirCanal(${index})" title="Excluir">ðŸ—‘</button>
      </td>
    </tr>
  `).join('');
}

function openModalNovoCanal() {
  document.getElementById('titulo-canal').textContent = 'Novo Canal de Venda';
  document.getElementById('canal-edit-index').value = '';
  document.getElementById('form-canal').reset();
  const ativo = document.getElementById('canal-ativo');
  if (ativo) ativo.checked = true;
  ModalManager.open('modal-canal');
}

function editarCanal(index) {
  const canal = appData.canais[index];
  document.getElementById('titulo-canal').textContent = 'Editar Canal de Venda';
  document.getElementById('canal-edit-index').value = index;
  document.getElementById('canal-codigo').value = canal.codigo;
  document.getElementById('canal-nome').value = canal.nome;
  const ativo = document.getElementById('canal-ativo');
  if (ativo) ativo.checked = canal.ativo !== false;
  ModalManager.open('modal-canal');
}

function salvarCanal() {
  const codigo = document.getElementById('canal-codigo').value.trim().toUpperCase();
  const nome = document.getElementById('canal-nome').value.trim();
  const ativo = document.getElementById('canal-ativo').checked;
  const editIndex = document.getElementById('canal-edit-index').value;

  if (!codigo || !nome) {
    showToast('Preencha todos os campos obrigatÃ³rios', 'warning');
    return;
  }

  showLoading('Salvando canal...');
  const canal = { codigo, nome, ativo };

  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        ModalManager.close('modal-canal');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .salvarCanal(canal, editIndex !== '' ? parseInt(editIndex) : -1);
}

function excluirCanal(index) {
  openConfirmCanal('Tem certeza que deseja excluir este canal?', index);
}

function alternarCanal(index, ativar) {
  showLoading(ativar ? 'Ativando canal...' : 'Inativando canal...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .toggleCanal(index, ativar);
}

function openConfirmCanal(msg, index) {
  canalIndexParaExcluir = index;
  const msgEl = document.getElementById('confirm-canal-message');
  if (msgEl) msgEl.textContent = msg;
  ModalManager.open('modal-confirm-canal');
}

function confirmExcluirCanal() {
  if (canalIndexParaExcluir === null) return;
  const index = canalIndexParaExcluir;
  canalIndexParaExcluir = null;
  ModalManager.close('modal-confirm-canal');
  showLoading('Excluindo...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .excluirCanal(index);
}

// ---------------------------------------------------------------------------
// Filiais
// ---------------------------------------------------------------------------
let filialIndexParaExcluir = null;

function loadFiliais() {
  const tbody = document.getElementById('table-filiais');
  if (!tbody) return;

  if (!appData.filiais || appData.filiais.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Nenhuma filial cadastrada</td></tr>';
    return;
  }

  tbody.innerHTML = appData.filiais.map((filial, index) => `
    <tr>
      <td><strong>${filial.codigo}</strong></td>
      <td>${filial.nome}</td>
      <td>
        <span class="badge badge-${filial.ativo === false ? 'secondary' : 'success'}">
          ${filial.ativo === false ? 'Inativo' : 'Ativo'}
        </span>
      </td>
      <td class="text-right">
        <button class="btn btn-sm btn-secondary" onclick="editarFilial(${index})" title="Editar">âœŽ</button>
        <button class="btn btn-sm ${filial.ativo === false ? 'btn-success' : 'btn-warning'}" onclick="alternarFilial(${index}, ${filial.ativo === false})" title="${filial.ativo === false ? 'Ativar' : 'Inativar'}">
          ${filial.ativo === false ? 'Ativar' : 'Inativar'}
        </button>
        <button class="btn btn-sm btn-danger" onclick="excluirFilial(${index})" title="Excluir">ðŸ—‘</button>
      </td>
    </tr>
  `).join('');
}

function openModalNovaFilial() {
  document.getElementById('titulo-filial').textContent = 'Nova Filial';
  document.getElementById('filial-edit-index').value = '';
  document.getElementById('form-filial').reset();
  const ativo = document.getElementById('filial-ativo');
  if (ativo) ativo.checked = true;
  ModalManager.open('modal-filial');
}

function editarFilial(index) {
  const filial = appData.filiais[index];
  document.getElementById('titulo-filial').textContent = 'Editar Filial';
  document.getElementById('filial-edit-index').value = index;
  document.getElementById('filial-codigo').value = filial.codigo;
  document.getElementById('filial-nome').value = filial.nome;
  const ativo = document.getElementById('filial-ativo');
  if (ativo) ativo.checked = filial.ativo !== false;
  ModalManager.open('modal-filial');
}

function salvarFilial() {
  const codigo = document.getElementById('filial-codigo').value.trim().toUpperCase();
  const nome = document.getElementById('filial-nome').value.trim();
  const ativo = document.getElementById('filial-ativo').checked;
  const editIndex = document.getElementById('filial-edit-index').value;

  if (!codigo || !nome) {
    showToast('Preencha todos os campos obrigatÃ³rios', 'warning');
    return;
  }

  showLoading('Salvando filial...');
  const filial = { codigo, nome, ativo };

  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        ModalManager.close('modal-filial');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .salvarFilial(filial, editIndex !== '' ? parseInt(editIndex) : -1);
}

function excluirFilial(index) {
  openConfirmFilial('Tem certeza que deseja excluir esta filial?', index);
}

function alternarFilial(index, ativar) {
  showLoading(ativar ? 'Ativando filial...' : 'Inativando filial...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .toggleFilial(index, ativar);
}

function openConfirmFilial(msg, index) {
  filialIndexParaExcluir = index;
  const msgEl = document.getElementById('confirm-filial-message');
  if (msgEl) msgEl.textContent = msg;
  ModalManager.open('modal-confirm-filial');
}

function confirmExcluirFilial() {
  if (filialIndexParaExcluir === null) return;
  const index = filialIndexParaExcluir;
  filialIndexParaExcluir = null;
  ModalManager.close('modal-confirm-filial');
  showLoading('Excluindo...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadReferenceData();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .excluirFilial(index);
}

// ---------------------------------------------------------------------------
// UsuÃ¡rios
// ---------------------------------------------------------------------------
let usuarioIndexParaExcluir = null;

function loadUsuarios() {
  showLoading();
  google.script.run
    .withSuccessHandler(usuarios => {
      hideLoading();
      usuariosData = usuarios || [];
      renderUsuarios();
    })
    .withFailureHandler(handleError)
    .getUsuarios();
}

function renderUsuarios() {
  const tbody = document.getElementById('table-usuarios');
  if (!tbody) return;

  if (!usuariosData || usuariosData.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Nenhum usuÃ¡rio cadastrado</td></tr>';
    return;
  }

  tbody.innerHTML = usuariosData.map((user, index) => `
    <tr>
      <td>${user.email}</td>
      <td>${user.nome}</td>
      <td><span class="badge badge-${getPerfilBadge(user.perfil)}">${getPerfilLabel(user.perfil)}</span></td>
      <td><span class="badge badge-${user.status === 'ATIVO' ? 'success' : 'secondary'}">${user.status}</span></td>
      <td>${user.ultimoAcesso ? formatDate(user.ultimoAcesso) : 'Nunca'}</td>
      <td class="text-right">
        <button class="btn btn-sm btn-secondary" onclick="editarUsuario(${index})" title="Editar">âœŽ</button>
        <button class="btn btn-sm btn-danger" onclick="excluirUsuario(${index})" title="Excluir">ðŸ—‘</button>
      </td>
    </tr>
  `).join('');
}

function getPerfilBadge(perfil) {
  const badges = { 'ADMIN': 'danger', 'GESTOR': 'warning', 'OPERACIONAL': 'info', 'VISUALIZADOR': 'secondary' };
  return badges[perfil] || 'secondary';
}

function getPerfilLabel(perfil) {
  const labels = {
    'ADMIN': 'Administrador',
    'GESTOR': 'Gestor',
    'OPERACIONAL': 'Operacional',
    'VISUALIZADOR': 'Visualizador'
  };
  return labels[perfil] || perfil;
}

function openModalNovoUsuario() {
  document.getElementById('modal-usuario-title').textContent = 'Novo UsuÃ¡rio';
  document.getElementById('form-usuario').reset();
  document.getElementById('usuario-id').value = '';
  document.getElementById('usuario-status').value = 'ATIVO';
  document.getElementById('modal-usuario').style.display = 'flex';
}

function editarUsuario(index) {
  const user = usuariosData[index];
  document.getElementById('modal-usuario-title').textContent = 'Editar UsuÃ¡rio';
  document.getElementById('usuario-id').value = user.id || '';
  document.getElementById('usuario-email').value = user.email;
  document.getElementById('usuario-nome').value = user.nome;
  document.getElementById('usuario-perfil').value = user.perfil;
  document.getElementById('usuario-status').value = user.status;

  // PermissÃµes
  const perms = user.permissoes || {};
  document.getElementById('perm-criar-lancamentos').checked = !!perms.criarLancamentos;
  document.getElementById('perm-editar-lancamentos').checked = !!perms.editarLancamentos;
  document.getElementById('perm-excluir-lancamentos').checked = !!perms.excluirLancamentos;
  document.getElementById('perm-aprovar-pagamentos').checked = !!perms.aprovarPagamentos;
  document.getElementById('perm-visualizar-relatorios').checked = !!perms.visualizarRelatorios;
  document.getElementById('perm-gerenciar-config').checked = !!perms.gerenciarConfig;

  document.getElementById('modal-usuario').style.display = 'flex';
}

function closeModalUsuario() {
  document.getElementById('modal-usuario').style.display = 'none';
}

function salvarUsuario() {
  const userData = {
    id: document.getElementById('usuario-id').value,
    email: document.getElementById('usuario-email').value,
    nome: document.getElementById('usuario-nome').value,
    perfil: document.getElementById('usuario-perfil').value,
    status: document.getElementById('usuario-status').value,
    permissoes: {
      criarLancamentos: document.getElementById('perm-criar-lancamentos').checked,
      editarLancamentos: document.getElementById('perm-editar-lancamentos').checked,
      excluirLancamentos: document.getElementById('perm-excluir-lancamentos').checked,
      aprovarPagamentos: document.getElementById('perm-aprovar-pagamentos').checked,
      visualizarRelatorios: document.getElementById('perm-visualizar-relatorios').checked,
      gerenciarConfig: document.getElementById('perm-gerenciar-config').checked
    }
  };

  showLoading();
  closeModalUsuario();

  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadUsuarios();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .salvarUsuario(userData);
}

function excluirUsuario(index) {
  const user = usuariosData[index];
  openConfirmUsuario(`Tem certeza que deseja excluir o usuÃ¡rio ${user.nome}?`, index);
}

function openConfirmUsuario(msg, index) {
  usuarioIndexParaExcluir = index;
  const msgEl = document.getElementById('confirm-usuario-message');
  if (msgEl) msgEl.textContent = msg;
  ModalManager.open('modal-confirm-usuario');
}

function confirmExcluirUsuario() {
  if (usuarioIndexParaExcluir === null) return;
  const index = usuarioIndexParaExcluir;
  const user = usuariosData[index];
  usuarioIndexParaExcluir = null;
  ModalManager.close('modal-confirm-usuario');
  showLoading('Excluindo...');
  google.script.run
    .withSuccessHandler(result => {
      hideLoading();
      if (result.success) {
        showToast(result.message, 'success');
        loadUsuarios();
      } else {
        showToast(result.message, 'error');
      }
    })
    .withFailureHandler(handleError)
    .excluirUsuario(user.id || user.email);
}

document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('form-usuario');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      salvarUsuario();
    });
  }

  document.addEventListener('click', function(e) {
    const target = e.target;
    if (target && target.classList && target.classList.contains('modal-overlay')) {
      ModalManager.closeAll();
    }
  });
});
</script>
