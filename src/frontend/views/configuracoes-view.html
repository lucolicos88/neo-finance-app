<div class="page-header">
  <h1 class="page-title">Configura√ß√µes</h1>
  <p class="page-subtitle">Gerencie os dados de refer√™ncia do sistema</p>
</div>

<div class="tabs-container">
  <div class="tabs">
    <button class="tab active" data-tab-group="config" data-tab="centros-custo">üè∑ Centros de Custo</button>
    <button class="tab" data-tab-group="config" data-tab="plano-contas">üìí Plano de Contas</button>
    <button class="tab" data-tab-group="config" data-tab="canais">üõç Canais de Venda</button>
    <button class="tab" data-tab-group="config" data-tab="caixas">Caixas</button>
    <button class="tab" data-tab-group="config" data-tab="filiais">üè¢ Filiais</button>
    <button class="tab" data-tab-group="config" data-tab="usuarios">üë• Usu√°rios</button>
    <button class="tab" data-tab-group="config" data-tab="logs">Logs</button>
    <button class="tab" data-tab-group="config" data-tab="diagnosticos">?? Diagnosticos</button>
  </div>
</div>

<!-- Centros de Custo -->
<div class="tab-content active" data-tab-content="config" data-content="centros-custo">
  <div class="card">
    <div class="card-header">
      <h3>Centros de Custo</h3>
      <button class="btn btn-primary" onclick="openModalNovoCentroCusto()">+ Novo Centro de Custo</button>
    </div>
    <div class="card-body">
      <div class="table-responsive table-no-scroll">
        <table class="table table-plano-contas">
                    <thead>
            <tr>
              <th>C?digo</th>
              <th>Nome</th>
              <th>Status</th>
              <th class="text-right">A??es</th>
            </tr>
          </thead>
          <tbody id="table-centros-custo">
            <tr><td colspan="4" class="text-center text-muted">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Logs -->
<div class="tab-content" data-tab-content="config" data-content="logs">
  <div class="card">
    <div class="card-header">
      <h3>Logs (Auditoria)</h3>
    </div>
    <div class="card-body">
      <p class="text-muted" style="margin-bottom: 1rem;">Dispon√≠vel apenas para administradores.</p>
      <div style="display:flex; gap: 0.75rem; flex-wrap: wrap; align-items: end; margin-bottom: 1rem;">
        <div>
          <label class="form-label" for="logs-query">Pesquisar</label>
          <input id="logs-query" class="form-control" type="text" placeholder="email, a√ß√£o, mensagem..." oninput="applyLogsFilter()" />
        </div>
        <div>
          <label class="form-label" for="logs-email">Email</label>
          <input id="logs-email" class="form-control" type="text" placeholder="usuario@empresa.com" oninput="applyLogsFilter()" />
        </div>
        <div>
          <label class="form-label" for="logs-action">A√ß√£o</label>
          <input id="logs-action" class="form-control" type="text" placeholder="ex: salvarLancamento" oninput="applyLogsFilter()" />
        </div>
        <div>
          <label class="form-label" for="logs-ref">Ref</label>
          <input id="logs-ref" class="form-control" type="text" placeholder="correlationId" oninput="applyLogsFilter()" />
        </div>
        <div>
          <label class="form-label" for="logs-status">Status</label>
          <select id="logs-status" class="form-control" onchange="applyLogsFilter()">
            <option value="">Todos</option>
            <option value="ok">OK</option>
            <option value="erro">Erro</option>
          </select>
        </div>
        <div style="margin-left:auto;">
          <button class="btn btn-secondary" onclick="refreshLogs()">Atualizar</button>
          <button class="btn btn-secondary" onclick="searchLogsServer()">Buscar no servidor</button>
          <button class="btn btn-primary" onclick="exportLogsCsv()">Exportar CSV</button>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-caixa-tipos">
          <thead>
            <tr>
              <th>Timestamp</th>
              <th>Email</th>
              <th>A√ß√£o</th>
              <th>Status</th>
              <th>Ref</th>
              <th>Mensagem</th>
              <th>Payload</th>
            </tr>
          </thead>
          <tbody id="table-logs">
            <tr><td colspan="7" class="text-center text-muted">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="tab-content" data-tab-content="config" data-content="diagnosticos">
<div class="card" style="margin-top: 1.25rem;">
  <div class="card-header">
    <h3>Diagn√≥sticos</h3>
    <div style="display:flex; gap: 0.5rem; margin-left:auto;">
      <button class="btn btn-primary" onclick="runSmokeTestsUi()">Rodar Smoke Tests</button>
      <button class="btn btn-secondary" onclick="copySmokeTestsOutput()">Copiar Resultado</button>
    </div>
  </div>
  <div class="card-body">
    <p class="text-muted" style="margin-bottom: 0.75rem;">Use para validar rapidamente o backend (ADMIN). Se falhar, envie o resultado para an√°lise.</p>
    <div style="display:flex; gap: 0.75rem; flex-wrap: wrap; align-items: end; margin-bottom: 0.75rem;">
      <div>
        <label class="form-label">ENABLE_DEBUG_API</label>
        <div style="display:flex; gap:0.5rem; align-items:center;">
          <input id="flag-enable-debug-api" type="checkbox" onchange="toggleAdminFlag('ENABLE_DEBUG_API', this.checked)" />
          <span class="text-muted" style="font-size:0.85rem;">Habilita endpoint `?api=` no `doGet`</span>
        </div>
      </div>
      <div>
        <label class="form-label">ENABLE_SEED_DATA</label>
        <div style="display:flex; gap:0.5rem; align-items:center;">
          <input id="flag-enable-seed-data" type="checkbox" onchange="toggleAdminFlag('ENABLE_SEED_DATA', this.checked)" />
          <span class="text-muted" style="font-size:0.85rem;">Permite seed autom√°tico em abas vazias</span>
        </div>
      </div>
      <div style="margin-left:auto; display:flex; gap:0.5rem;">
        <button class="btn btn-secondary" onclick="loadAdminDiagnostics()">Atualizar Flags</button>
        <button class="btn btn-warning" onclick="clearCachesUi()">Limpar Caches</button>
      </div>
    </div>
    <pre id="smoke-tests-output" style="white-space: pre-wrap; margin: 0; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; background: #fafafa;">Clique em "Rodar Smoke Tests".</pre>
  </div>
</div>


</div>

<!-- Plano de Contas -->
<div class="tab-content" data-tab-content="config" data-content="plano-contas">
  <div class="card">
    <div class="card-header">
      <h3>Plano de Contas Cont√°bil</h3>
      <button class="btn btn-primary" onclick="openModalNovaConta()">+ Nova Conta Cont√°bil</button>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Nome</th>
              <th>Tipo</th>
              <th>Grupo DRE</th>
              <th>Subgrupo DRE</th>
              <th>Grupo DFC</th>
              <th>Var./Fixa</th>
              <th>CMA/CMV</th>
              <th class="text-right">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="table-plano-contas">
            <tr><td colspan="9" class="text-center text-muted">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Canais de Venda -->
<div class="tab-content" data-tab-content="config" data-content="canais">
  <div class="card">
    <div class="card-header">
      <h3>Canais de Venda</h3>
      <button class="btn btn-primary" onclick="openModalNovoCanal()">+ Novo Canal</button>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>C√≥digo</th>
              <th>Nome</th>
              <th>Status</th>
              <th class="text-right">A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="table-canais">
            <tr><td colspan="4" class="text-center text-muted">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


<!-- Caixas -->
<div class="tab-content" data-tab-content="config" data-content="caixas">
  <div class="card">
    <div class="card-header">
      <h3>Caixas</h3>
    </div>
    <div class="card-body">
      <div style="display:flex; gap: 1rem; flex-wrap: wrap; align-items: end;">
        <div style="flex:1; min-width: 260px;">
          <label class="form-label">Pasta Drive (URL ou ID)</label>
          <input id="caixas-pasta-id" class="form-control" type="text" placeholder="https://drive.google.com/drive/folders/..." />
          <div class="text-muted" id="caixas-pasta-atual" style="margin-top: 0.4rem; font-size: 0.85rem;"></div>
        </div>
        <div>
          <button class="btn btn-primary" onclick="salvarCaixasConfig()">Salvar Pasta</button>
        </div>
      </div>
    </div>
  </div>
  <div class="card" style="margin-top: 1rem;">
    <div class="card-header">
      <h3>Tipos de Movimentacao</h3>
      <button class="btn btn-primary" onclick="openModalNovoCaixaTipo()">+ Novo Tipo</button>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-logs">
          <thead>
            <tr>
              <th>Tipo</th>
              <th>Natureza</th>
              <th>Requer Arquivo</th>
              <th>Sistema FC</th>
              <th>Conta Reforco</th>
              <th>Status</th>
              <th class="text-right">Acoes</th>
            </tr>
          </thead>
          <tbody id="table-caixa-tipos">
            <tr><td colspan="7" class="text-center text-muted">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Filiais -->
<div class="tab-content" data-tab-content="config" data-content="filiais">
  <div class="card">
    <div class="card-header">
      <h3>Filiais</h3>
      <button class="btn btn-primary" onclick="openModalNovaFilial()">+ Nova Filial</button>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table">
                    <thead>
            <tr>
              <th>C?digo</th>
              <th>Nome</th>
              <th>SIEG Relatorio</th>
              <th>SIEG Contabilidade</th>
              <th>Status</th>
              <th class="text-right">A??es</th>
            </tr>
          </thead>
          <tbody id="table-filiais">
            <tr><td colspan="6" class="text-center text-muted">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Usu√°rios -->
<div class="tab-content" data-tab-content="config" data-content="usuarios">
  <div class="card">
    <div class="card-header">
      <h3>Usu√°rios e Permiss√µes</h3>
      <button class="btn btn-primary" onclick="openModalNovoUsuario()">+ Novo Usu√°rio</button>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Email</th>
              <th>Nome</th>
              <th>Perfil</th>
              <th>Canal</th>
              <th>Status</th>
              <th>Ultimo Acesso</th>
              <th class="text-right">Acoes</th>
            </tr>
          </thead>
          <tbody id="table-usuarios">
            <tr><td colspan="7" class="text-center text-muted">Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top: 1.5rem;">
    <div class="card-header"><h3>Perfis de Acesso</h3></div>
    <div class="card-body">
      <div style="display: grid; grid-template-columns: repeat(5, minmax(180px, 1fr)); gap: 1rem;">
        <div style="padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px;">
          <h4 style="margin-bottom: 0.5rem; color: #D72C0D;">üëë Administrador</h4>
          <p style="font-size: 0.9rem; color: #666;">Acesso total ao sistema. Pode gerenciar usu√°rios, configura√ß√µes e todas as funcionalidades.</p>
        </div>
        <div style="padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px;">
          <h4 style="margin-bottom: 0.5rem; color: #FF6B35;">üß≠ Gestor Financeiro</h4>
          <p style="font-size: 0.9rem; color: #666;">Pode visualizar e editar lan√ßamentos, aprovar contas, gerar relat√≥rios.</p>
        </div>
        <div style="padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px;">
          <h4 style="margin-bottom: 0.5rem; color: #4ECDC4;">üîß Operacional</h4>
          <p style="font-size: 0.9rem; color: #666;">Pode criar e editar lan√ßamentos, mas n√£o aprovar ou excluir.</p>
        </div>
        <div style="padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px;">
          <h4 style="margin-bottom: 0.5rem; color: #2E7D32;">üí∞ Caixa</h4>
          <p style="font-size: 0.9rem; color: #666;">Acesso ao m√≥dulo Caixas para fechamento e upload de comprovantes.</p>
        </div>
        <div style="padding: 1rem; border: 1px solid #e0e0e0; border-radius: 8px;">
          <h4 style="margin-bottom: 0.5rem; color: #95E1D3;">üëÅ Visualizador</h4>
          <p style="font-size: 0.9rem; color: #666;">Apenas leitura. Pode visualizar relat√≥rios e dashboards.</p>
        </div>
      </div>
    </div>
  </div>
</div>
